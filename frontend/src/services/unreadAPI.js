import enhancedAPI from './enhancedAPI';

/**
 * API service ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ unread message count
 */
export const unreadAPI = {
  /**
   * ‡∏î‡∏∂‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
   * @param {string} userId - ID ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
   * @returns {Promise<Object>} ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡πà‡∏≤‡∏ô
   */
  async getUnreadCount(userId) {
    try {
      console.log('üîç Fetching unread count for user:', userId);
      const response = await enhancedAPI.get(`/api/messages/unread-count/${userId}`);
      console.log('‚úÖ Unread count response:', response);
      return response;
    } catch (error) {
      console.error('‚ùå Error getting unread count:', error);
      
      // Return fallback data ‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£ throw error
      return {
        success: false,
        data: {
          totalUnreadCount: 0,
          chatUnreadCounts: []
        },
        error: error.message
      };
    }
  },

  /**
   * ‡∏î‡∏∂‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ä‡∏ó‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
   * @param {string} userId - ID ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
   * @returns {Promise<Object>} ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ä‡∏ó‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß
   */
  async getPrivateChatUnreadCount(userId) {
    try {
      console.log('üîç Fetching private chat unread count for user:', userId);
      const response = await enhancedAPI.get(`/api/messages/private-chats-unread/${userId}`);
      console.log('‚úÖ Private chat unread count response:', response);
      return response;
    } catch (error) {
      console.error('‚ùå Error getting private chat unread count:', error);
      
      // Return fallback data ‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£ throw error
      return {
        success: false,
        data: {
          totalUnreadCount: 0,
          chatUnreadCounts: []
        },
        error: error.message
      };
    }
  },

  /**
   * ‡∏ó‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ß‡πà‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß
   * @param {string} chatRoomId - ID ‡∏Ç‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏ä‡∏ó
   * @param {string} userId - ID ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
   * @returns {Promise<Object>} ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢
   */
  async markAsRead(chatRoomId, userId) {
    try {
      const response = await enhancedAPI.post('/api/messages/mark-as-read', {
        chatRoomId,
        userId
      });
      
      if (response.success) {
        return response.data;
      } else {
        console.warn('Mark as read failed:', response.error);
        return null;
      }
    } catch (error) {
      console.error('Error marking messages as read:', error);
      return null;
    }
  },

  /**
   * ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏ó‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡πà‡∏≤‡∏ô
   * @param {string} userId - ID ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
   * @returns {Promise<Object>} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏ó‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß
   */
  async getPrivateChats(userId) {
    try {
      console.log('üîç Fetching private chats for user:', userId);
      const response = await enhancedAPI.get(`/api/messages/private-chats/${userId}`);
      console.log('‚úÖ Private chats response:', response);
      return response;
    } catch (error) {
      console.error('‚ùå Error getting private chats:', error);
      
      // Return fallback data ‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£ throw error
      return {
        success: false,
        data: {
          privateChats: [],
          total: 0
        },
        error: error.message
      };
    }
  }
};

export default unreadAPI;
